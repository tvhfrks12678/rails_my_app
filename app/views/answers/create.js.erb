var LBL_CHOICE_BACKGROUND_COLOR = ["#0074D9", "#F012BE", "#2ECC40", "#FF851B", "#B10DC9"]
var LBL_CHOICE_ID_PREFIX = "lbl_choice_id_";
var RHYME_CHOICE_ID_PREFIX = "rhyme_choice_id_";

var quizId = <%= @answer.quiz.id %>;
changeChoicesDisplayForAnswer(quizId);
hideBtnAnswer(quizId);
displayAnswerResult(quizId, <%= @answer.is_correct %>)

scrollQuizTop(quizId);

document.getElementById("main_answer_quiz_id_<%= @answer.quiz.id %>").innerHTML = "<%= escape_javascript(render('answers/info')) %>"

<% @answer.combinations.each_with_index do |answer_combination, idx| %>
  var rhymeWord = "<%= answer_combination.rhyme %>"
  var changeColorCode = LBL_CHOICE_BACKGROUND_COLOR[<%= idx %>];

  <% answer_combination.choice_ids.each do |choice_id| %>
    var choiceId = <%= choice_id %>;
    fillInChoiceLblColor(choiceId, changeColorCode);
    displayRhyme(choiceId, rhymeWord);
  <% end %>
<% end %>

fadeinAnswerBy(quizId);

/**
 * 選択肢のテキスト部分を塗り潰す
 * @param {number} choiceId 
 * @param {string} changeColorCode
 */
function fillInChoiceLblColor(choiceId, changeColorCode) {
  const lblChoiceId = `${LBL_CHOICE_ID_PREFIX}${choiceId}`;
  const lblChoiceElement = document.getElementById(lblChoiceId);
  lblChoiceElement.parentNode.style.backgroundColor = changeColorCode;
  lblChoiceElement.parentNode.style.borderColor = changeColorCode; 
  lblChoiceElement.style.color = "white"
}

/**
 * 母音を選択肢の下に表示する
 * @param {number} choiceId 
 * @param {string} rhymeWord
 */
function displayRhyme(choiceId, rhymeWord) {
  const rhymeChoiceId = `${RHYME_CHOICE_ID_PREFIX}${choiceId}`;
  document.getElementById(rhymeChoiceId).innerText = rhymeWord;
}

/**
 * 選択肢を不活性にし、回答表示用で表示する
 * @param {number} quizId 
 */
function changeChoicesDisplayForAnswer(quizId) {
  const cardQuizId = `card_quiz_${quizId}`;
  const container = document.querySelector(`#${cardQuizId}`);
  const chkElementList = container.querySelectorAll('input[type=checkbox]');
  chkElementList.forEach(chkElement => {
    chkElement.disabled = true;
    
    const choiceElement = chkElement.parentElement 
    choiceElement.style.backgroundColor = "transparent"

    if (chkElement.checked === true) {
      chkElement.style.display = "inline"
    }
  })

  const choiceSentenceElementList = container.querySelectorAll('.choice_sentence');
  choiceSentenceElementList.forEach(choiceSentenceElement => {
    const choiceSentenceElementStyle = choiceSentenceElement.style 
    choiceSentenceElementStyle.color = "#0175fe"
    choiceSentenceElementStyle.margin = "6px 0px"
  })
}

/**
 * 回答ボタンを非表示にする
 * @param {number} quizId 
 */
function hideBtnAnswer(quizId) {
  const btnQuizId = `btn_quiz_id_${quizId}`;
  const btnAnswerElement = document.getElementById(btnQuizId);
  btnAnswerElement.style.display = "none";  
}

/**
 * 回答の結果と解説を表示する
 * @param {number} quizId 
 * @param {boolean} is_correct true:正解, ture:不正解
 */
function displayAnswerResult(quizId, is_correct) {
  let resultSymbol = '❌';
  let resultWord = '不正解';

  if (is_correct === true) {
    resultSymbol = '⭕️';
    resultWord = '正解!';
  }
  const cardQuizId = `card_quiz_${quizId}`;
  const container = document.querySelector(`#${cardQuizId}`);

  container.querySelector('.mark_symbol').textContent = resultSymbol 
  container.querySelector('.lbl_question_sentence').textContent = resultWord;
  container.querySelector('.lbl_question_sentence').style.color = "#FF4136"
  container.querySelector('.lbl_question_sentence').style.fontSize = "60px"
  container.querySelector('.lbl_question_sentence').style.paddingLeft = "10px"
}

/**
 * クイズのトップにスクロールする
 * @param {number} quizId 
 */
function scrollQuizTop(quizId) {
  const marginTop = 70
  const cardQuizId = `card_quiz_${quizId}`;
  const cardQuizIdElement = document.getElementById(cardQuizId)
  cardQuizIdElement.scrollIntoView(true)
  window.scrollBy(0, marginTop * -1)
}

/**
 * 回答をフェードインして表示する
 * @param {number} quizId 
 */
function fadeinAnswerBy(quizId) {
  const cardQuizId = `card_quiz_${quizId}`;
  const container = document.getElementById(cardQuizId);
  container.animate([{opacity: '0'}, {opacity: '1'}], 1500)
}