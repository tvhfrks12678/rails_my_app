var LBL_CHOICE_BACKGROUND_COLOR = ["#AEFFBD", "#DCC2FF", "#E9FFA5", "#BAD3FF", "#FFABCE"]
var LBL_CHOICE_ID_PREFIX = "lbl_choice_id_";
var RHYME_CHOICE_ID_PREFIX = "rhyme_choice_id_";

document.getElementById("main_answer_quiz_id_<%= @answer.quiz.id %>").innerHTML = "<%= escape_javascript(render('answers/info')) %>"

<% @answer.combinations.each_with_index do |answer_combination, idx| %>
  var rhymeWord = "<%= answer_combination.rhyme %>"
  var changeColorCode = LBL_CHOICE_BACKGROUND_COLOR[<%= idx %>];

  <% answer_combination.choice_ids.each do |choice_id| %>
    var choiceId = <%= choice_id %>;
    fillInChoiceLblColor(choiceId, changeColorCode);
    displayRhyme(choiceId, rhymeWord);
  <% end %>
<% end %>

var quizId = <%= @answer.quiz.id %>;
changeChoicesDisplayForAnswer(quizId);
hideBtnAnswer(quizId);

/**
 * 選択肢のテキスト部分を塗り潰す
 * @param {number} choiceId 
 * @param {string} changeColorCode
 */
function fillInChoiceLblColor(choiceId, changeColorCode) {
  const lblChoiceId = `${LBL_CHOICE_ID_PREFIX}${choiceId}`;
  const lblChoiceElementStyle = document.getElementById(lblChoiceId).style;
  lblChoiceElementStyle.backgroundColor = changeColorCode;
  lblChoiceElementStyle.borderRadius = "0.2em"
}

/**
 * 母音を選択肢の下に表示する
 * @param {number} choiceId 
 * @param {string} rhymeWord
 */
function displayRhyme(choiceId, rhymeWord) {
  const rhymeChoiceId = `${RHYME_CHOICE_ID_PREFIX}${choiceId}`;
  document.getElementById(rhymeChoiceId).innerText = rhymeWord;
}

/**
 * 選択肢を不活性にし、回答表示用で表示する
 * @param {number} quizId 
 */
function changeChoicesDisplayForAnswer(quizId) {
  const cardQuizId = `card_quiz_${quizId}`;
  const container = document.querySelector(`#${cardQuizId}`);
  const chkElementList = container.querySelectorAll('input[type=checkbox]');
  chkElementList.forEach(chkElement => {
    chkElement.disabled = true
    const choiceElement = chkElement.parentElement 
    choiceElement.style.backgroundColor = "#FFFFFF"
    choiceElement.classList.remove('choice')
  })
}

/**
 * 回答ボタンを非表示にする
 * @param {number} quizId 
 */
function hideBtnAnswer(quizId) {
  const btnQuizId = `btn_quiz_id_${quizId}`;
  const btnAnswerElement = document.getElementById(btnQuizId);
  btnAnswerElement.style.display = "none";  
}
